<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<title>TribesV Servers</title>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.js"></script>
<script src="http://ajax.aspnetcdn.com/ajax/jquery.templates/beta1/jquery.tmpl.min.js"></script>
<!-- font from www.webpagepublicity.com -->
<style type="text/css">
@font-face {
 font-family: phoenix_font;
 src: url('http://dl.dropbox.com/u/39786635/alexisitalic.ttf');
}
@font-face {
 font-family: be_font;
 src: url('http://dl.dropbox.com/u/39786635/anythingyouwant.ttf');
}
@font-face {
 font-family: imp_font;
 src: url('http://dl.dropbox.com/u/39786635/aldosnova.ttf');
}
.cell {
 display: table-cell;
 padding-right : 10px
}
a.grey:link {color:#CCCCCC;}
a.grey:visited {color:#CCCCCC;}
a.grey:hover {color:#CCCCCC;}
a.grey:active {color:#CCCCCC;}
li.green:before {
display: marker;
content: "\2022 ";
color: green;
}
li.grey:before {
display: marker;
content: "\2022 ";
color: grey;
}
.BloodEagle {
 color: #8A0829;
 font-weight: bold;
 font-family: be_font;
}
.Imperial {
 color: #0404B4;
 font-family: imp_font;
}
.Phoenix {
 color: #868A08;
 font-family: phoenix_font;
}
</style>
<script type="text/javascript">//<![CDATA[
var debug = ""

function replace(name, json){
  $('#'+name).hide()
  $('#'+name).empty();
  $('#'+name+'Template' ).tmpl( json ).appendTo('#' +name);
  $('#'+name).fadeIn('fast', function(){});
}

function toggleSpin(){
 var base = "/ajax-loader.gif"
 if ($('#spinner').attr('src') == base){
  $('#spinner').attr('src', 'http://dl.dropbox.com/u/39786635/reload.png')
 } else {
  $('#spinner').attr('src', base)
 }
}

function ask(href){
  toggleSpin()
  return $.getJSON(href,
    function(json) {
      if (href == "/list.json"){
        replace('servers', json);
      } else {
        replace('server', json);
      }
    }).error(function(jx, txt, err) { alert(txt + "(" +err+ ") :" + jx.responseText); })
      .complete(function(){
        toggleSpin()
        $('#debug').html(debug);
      });
}

$(document).ready(function() {
  toggleSpin()
  ask("/list.json")

  $("a").live('click', function(e) {
    debug = ""
    e.preventDefault();
    ask($(this).attr("href"));
  })
});
//]]></script>

<script id="serversTemplate" type="text/x-jquery-tmpl">
<li class='{{if numplayers>0 }}green{{else}}grey{{/if}}'>
 <a {{if numplayers==0 }}class="grey"{{/if}} href="/${ip}/${port}.json">${hostname}</a> <font {{if numplayers==0 }}color="lightgrey"{{/if}}>(${numplayers}/${maxplayers})</font>
</li>
</script>

<script id="serverTemplate" type="text/x-jquery-tmpl">
 <div><b>${name}</b> (Password? : ${password})</div>
 <div>Players : ${numplayers} / ${maxplayers}</div>
 <div>{{tmpl(admin) "#adminTemplate"}}</div>
 <div>{{tmpl(game) "#gameTemplate"}}</div>
</script>

<script id="adminTemplate" type="text/x-jquery-tmpl">Admin : ${name} (${email})</script>

<script id="gameTemplate" type="text/x-jquery-tmpl">
 <div>Map : ${map} (${gametype})</div>
 <div>Scores : {{tmpl(team1) "#teamTemplate"}} / {{tmpl(team2) "#teamTemplate"}}</div>
 <div class="players" style="display: table">
  <div style="display: table-row; font-weight:bold">
   <span class="cell">Player</span>
   <span class="cell">ping</span>
   <span class="cell">team</span>
   <span class="cell">score</span>
  </div>
  {{tmpl(players) "#playerTemplate"}}
  </div>
</script>

<script id="teamTemplate" type="text/x-jquery-tmpl">
  {{tmpl(name) "#teamNameTemplate"}} ${score}
</script>
<script id="teamNameTemplate" type="text/x-jquery-tmpl">
 <span class='${$item.data.replace(" ", "")}' >${$item.data}</span>
</script>

<script id="playerTemplate" type="text/x-jquery-tmpl">
  <div class="subelem" style="display: table-row">
   <span class="cell">${name}</span>
   <span class="cell">${ping}</span>
   <span class="cell">{{if team}}{{tmpl(team) "#teamNameTemplate"}}{{/if}}</span>
   <span class="cell">${score}</span>
  </div>
</script>

</head>
<body>
<a id="refresh" href="/list.json"><img src="/ajax-loader.gif" id="spinner"/></a>
 <ul id="servers" style="list-style-type: none;padding: 5;margin:0"></ul>
 <div id="server"></div>
 <span id="debug"></span>
</body>
</html>
